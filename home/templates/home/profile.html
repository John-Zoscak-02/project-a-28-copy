{% extends 'home/base.html' %}

{# Load the tag library #}
{% load bootstrap5 %}

{# Load CSS and JavaScript #}
{% bootstrap_css %}
{% bootstrap_javascript %}

{# Display django.contrib.messages as Bootstrap alerts #}
{% bootstrap_messages %}

{% if user.is_authenticated %}
{% block title %}Profile of: {{profile.user}}{% endblock %}
{% endif %}

{% block content %}
<div class='container column gap-2'>
    <div class="row p-2">
        <h3>Friends:</h3>
        <div class="card example-1 scrollbar-ripe-malinka">
            <div class="card-body">
                <p class="h6">{{profile.get_friends_no}} friend(s)</p>                    
                <ul>
                {% for friend in profile.get_friends %}
                    <li><a class='item-group' href="/profile/{{friend.profile.id}}">{{friend.first_name}} {{friend.last_name}} ({{friend.username}})</a></li>
                {% endfor %}
                </ul>
            </div>
        </div>
    </div>
    <div class="row p-2">
        <h3>Schedule: </h3>
        <ul>
            {% for class in profile.schedule.classes.all %}
            <li class="list-group-item">
                <div class="container">
                    <div class="row align-items-center">
                        <div class="col-1">
                            <small>{{ class.course.department.subject }}: {{ class.course.catalog_number }}</small>
                        </div>
                        <div class="col-2">
                            <small>{{ class.course.description }}</small>
                        </div>
                        <div class="col-2">
                            <small>{{ class.course.units }} Units | </small>
                            <small>{{ class.enrollment_available }}/{{ class.enrollment_total }} Seats</small>
                        </div>
                        <div class="col-2">
                            <small>{{ class.prof_name }}</small>
                        </div>
                        <div class="col-2">
                            <small>{{class.days}} {{ class.start_time|slice:"0:2" }}:{{ class.start_time|slice:"3:5" }} - {{class.end_time|slice:"0:2"}}:{{ class.end_time|slice:"3:5" }}</small>
                        </div>
                        <div class="col-2">
                            <small>{{ class.facility_description }}</small>
                        </div>
                        <div class="col-1">
                            <form method="post" id="remove_class_form-{{ class.section_number }}">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-danger btn-xs rounded-pill" name="class_remove"
                                    id="{{ class.section_number }}" value="{{ class }}">
                                    <small>Remove</small>
                                </button>
                            </form>
                            <script src="https://code.jquery.com/jquery-3.5.1.js" 
                                    integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
                                    crossorigin="anonymous"></script>
                            <script type="text/javascript">
                                $(document).on('submit', '#remove_class_form-{{ class.section_number }}', function (e) {
                                    e.preventDefault();
                                    $.ajax({
                                        type: 'POST',
                                        url: '{% url "home:profile_view" profile.id %}',
                                        data:
                                        {
                                            class_remove: $("#{{ class.section_number }}").val(),
                                            csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
                                        },
                                        success: function () { },
                                    })
                                });
                            </script>
                        </div>
                    </div>
                </li>
                {% endfor %}
            </ul>
            <!--{% for meeting in profile.schedule.classes.all|get_events %}
                {{meeting.summary}}: {{meeting.start.date}} to {{meeting.end.date}}
                <br/>
            {% endfor %}-->
            <!--<iframe
                src="https://calendar.google.com/calendar/embed?height=750&wkst=1&bgcolor=%23ffffff&ctz=America%2FNew_York&mode=WEEK&showTitle=0&showNav=0&showDate=0&showPrint=0&showTabs=0&showCalendars=0&showTz=0&src=Y184ZGM5YTI4MDM4ZTY5Zjc3OTdlYmRhZGE1ZDdhMDc0MmE4ODQyNTg3OTUxN2IzODUwMmU2MmFmM2FlMDk3NmE5QGdyb3VwLmNhbGVuZGFyLmdvb2dsZS5jb20&color=%239E69AF"
                style="border-width:0" width="1000" height="600" frameborder="0" scrolling="no"></iframe>-->
                  <form method="POST">
                    {% csrf_token %}
                    
                  </form>
    {% else %}
    <p><strong><font color='red'>You must login to view member profiles</font></strong></p>
    {% endif %}
    {% autoescape off %}{% bootstrap_messages %}{% endautoescape %}
</div>

<a class="btn btn-default" href="<div data-gb-custom-block data-tag="url" data-0='add_comment_to_post'></div>

    ">Add comment</a>
<hr>
<div data-gb-custom-block data-tag="for"></div>

    <div class="comment">
        <div class="date">{{ comment.date }}</div>
        <strong>{{ comment.user }}</strong>
        <p>{{ comment.content|linebreaks }}</p>
    </div>

<div data-gb-custom-block data-tag="empty">

    <p>No comments here yet :(</p>

</div>

{% endblock %}
